<?php

module_load_include('test', 'simpletest_clone');

class UserTestCase extends DrupalWebTestCase {

  public static function getInfo() {
  return array(
    'name' => 'User test',
    'description' => 'Test creating user',
    'group' => 'Bibliotouris',
    );
  }

  public function setUp() {
  parent::setup('bibliothouris_user');
  /*  $roles = user_roles();
    $role = 'employee';

    // Find the index for the role we want to assign to the user.
    $index = array_search($role, $roles);


    // Get the permissions for the role.
    $permissions = user_role_permissions(array(array_search($role, $roles) => $role));


    // Create the user with the permissions.
    $user = $this->drupalCreateUser(array_keys($permissions[$index]));


    // Assign the role.
    $user->roles[$index] = $role;

    // Return the user we have created.
    $this->medewerker = $this->drupalCreateUser($permissions);
*/
  $this->medewerker = $this->drupalCreateUser(array('administer users', 'create users'));
  $this->drupalLogin($this->medewerker);

  }

  public function testCreateLibraryMember() {

    //invalid email
    $edit = array();
    $edit['mail'] = 'invalidEmail';
    $edit['field_national_number[und][0][value]'] = '9780553593716';
    $edit['field_last_name[und][0][value]'] = 'TestLastName';
    $edit['field_first_name[und][0][value]'] = 'TestFirstName';
    $this->drupalPost('admin/people/create', $edit, t('Create new account'));
    $this->assertText(t('The e-mail address @mail is not valid.', array('@mail' => $edit['mail'])));

    //valid fields, no password
    $edit = array();
    $edit['mail'] = 'test@test.com';
    $edit['field_national_number[und][0][value]'] = '9780553593716';
    $edit['field_last_name[und][0][value]'] = 'TestLastName';
    $edit['field_first_name[und][0][value]'] = 'TestFirstName';
    $this->drupalPost('admin/people/create', $edit, t('Create new account'));
    $this->assertText(t('Since you did not provide a password, it was generated automatically for this account.'));
    $this->assertText(t('A welcome message with further instructions has been e-mailed to the new user @username.', array('@username' => 'test')));

  }
}
